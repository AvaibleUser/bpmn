<div class="min-h-screen bg-base-100 py-8">
  @if (!discography) {
  <div class="flex justify-center items-center h-96">
    <div class="loading loading-spinner loading-lg text-primary"></div>
  </div>
  } @else if (discography) {
  <div class="container mx-auto px-4 xl:max-w-5xl 2xl:max-w-7xl">
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-12">
      <figure class="overflow-hidden aspect-square">
        <img
          [src]="discography.imageUrl || '/assets/images/default-album.png'"
          [alt]="discography.title"
          class="w-full h-full object-cover"
        />
      </figure>

      <div class="space-y-6">
        <div>
          <h1 class="text-6xl font-bold font-serif mb-4">{{ discography.title }}</h1>
          <h2 class="text-3xl text-base-content/70 mb-6">{{ discography.artist }}</h2>
          <div class="flex flex-wrap gap-4 items-center mb-4 text-xl">
            @if (discography.format === 'CASSETTE' && discography.cassetteCondition !== 'NEW') {
            <span class="line-through text-base-content/60">
              {{ discography.price | currency : 'GTQ' : 'symbol-narrow' }}
            </span>
            <span class="font-bold text-2xl">
              {{ discounted(discography) | currency : 'GTQ' : 'symbol-narrow' }}
            </span>
            <span class="badge badge-success badge-soft rounded-bl-3xl rounded-tl-3xl">
              <span class="animate-ping rounded-full bg-error size-1"></span>
              <i-lucide [img]="Discount" size="18" />
              {{ discount(discography) | percent }}
            </span>
            } @else {
            <span class="font-bold text-2xl">
              {{ discography.price | currency : 'GTQ' : 'symbol-narrow' }}
            </span>
            }
          </div>
        </div>

        <shop-add-item
          [id]="discography.id"
          productType="discographies"
          [stock]="discography.stock"
          btnClass="btn-xl"
        />

        <div class="flex flex-col gap-3">
          @for(detail of details(discography); track detail.label) { @if (detail.condition ===
          undefined || detail.condition) {
          <div class="flex items-center gap-2">
            <i-lucide [img]="detail.icon" size="24" class="text-ctp-teal" />
            <span class="font-bold">{{ detail.label }}:</span>
            <span class="text-base-content/80">{{ detail.value }}</span>
          </div>
          } }
        </div>

        @if (userRole === 'ADMIN') {
        <div class="flex gap-4">
          <button class="btn btn-soft btn-error btn-sm" (click)="delete()">
            <i-lucide [img]="Delete" size="20" />
            Eliminar
          </button>

          <button class="btn btn-soft btn-warning btn-sm">
            <i-lucide [img]="Edit" size="20" />
            Editar
          </button>
        </div>
        }
        <shop-songs [productId]="id()" />
      </div>
    </div>

    <div class="flex flex-col gap-6">
      <shop-rating [productId]="id()" [userRole]="userRole" />
      <shop-comments [productId]="id()" [userRole]="userRole" />

      @if (promotions?.length) {
      <div class="bg-base-200 p-6 rounded-lg max-w-3xl mx-auto">
        <h3 class="text-2xl font-bold mb-6 text-center">Promociones que incluyen este CD</h3>

        <div class="grid grid-cols-1 gap-8 md:grid-cols-2 w-full">
          @if (!promotions || !promotions.length) {
          <div class="text-center text-accent h-full flex items-center lg:col-span-2 xl:col-span-3">
            <p class="text-5xl">
              Buscando artistas que cambien el juego para tener existencias disponibles...
            </p>
          </div>
          } @else { @for (promotion of promotions; track promotion.id) {
          <shop-promotion [promotion]="promotion" />
          } }
        </div>
      </div>
      }
    </div>
  </div>
  }
</div>
